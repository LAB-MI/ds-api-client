#!/bin/bash
DEMARCHENUMBER=$1

curl --location --request POST 'https://www.demarches-simplifiees.fr/api/v2/graphql' \
--header 'Authorization: Bearer '$TOKEN_DEMARCHE'' \
--header 'Content-Type: application/json' \
--data-raw '{"query":"query getDemarche(\n  $demarcheNumber: Int!\n  $state: DossierState\n  $order: Order\n  $after: String\n) {\n  demarche(number: $demarcheNumber) {\n    id\n    number\n    title\n    publishedRevision {\n      ...RevisionFragment\n    }\n    groupeInstructeurs {\n      id\n      number\n      label\n      instructeurs {\n        id\n        email\n      }\n    }\n    dossiers(state: $state, order: $order, after: $after) {\n      nodes {\n        ...DossierFragment\n      }\n    }\n  }\n}\n\nfragment DossierFragment on Dossier {\n  id\n  number\n  archived\n  state\n  dateDerniereModification\n  dateDepot\n  datePassageEnConstruction\n  datePassageEnInstruction\n  dateTraitement\n  motivation\n  motivationAttachment {\n    ...FileFragment\n  }\n  attestation {\n    ...FileFragment\n  }\n  pdf {\n    url\n  }\n  instructeurs {\n    email\n  }\n  groupeInstructeur {\n    id\n    number\n    label\n  }\n  revision {\n    ...RevisionFragment\n  }\n  traitements {\n    state\n    emailAgentTraitant\n    dateTraitement\n    motivation\n  }\n  champs {\n    ...ChampFragment\n    ...RootChampFragment\n  }\n  annotations {\n    ...ChampFragment\n    ...RootChampFragment\n  }\n  avis {\n    ...AvisFragment\n  }\n  messages {\n    ...MessageFragment\n  }\n  demandeur {\n    ... on PersonnePhysique {\n      civilite\n      nom\n      prenom\n      dateDeNaissance\n    }\n    ...PersonneMoraleFragment\n  }\n}\n\nfragment RevisionFragment on Revision {\n  id\n  champDescriptors {\n    ...ChampDescriptorFragment\n    champDescriptors {\n      ...ChampDescriptorFragment\n    }\n  }\n  annotationDescriptors {\n    ...ChampDescriptorFragment\n    champDescriptors {\n      ...ChampDescriptorFragment\n    }\n  }\n}\n\nfragment ChampDescriptorFragment on ChampDescriptor {\n  id\n  type\n  label\n  description\n  required\n  options\n}\n\nfragment AvisFragment on Avis {\n  id\n  question\n  reponse\n  dateQuestion\n  dateReponse\n  claimant {\n    email\n  }\n  expert {\n    email\n  }\n  attachment {\n    ...FileFragment\n  }\n}\n\nfragment MessageFragment on Message {\n  id\n  email\n  body\n  createdAt\n  attachment {\n    ...FileFragment\n  }\n}\n\nfragment GeoAreaFragment on GeoArea {\n  id\n  source\n  description\n  geometry {\n    type\n    coordinates\n  }\n  ... on ParcelleCadastrale {\n    commune\n    numero\n    section\n    prefixe\n    surface\n  }\n}\n\nfragment RootChampFragment on Champ {\n  ... on RepetitionChamp {\n    champs {\n      ...ChampFragment\n    }\n  }\n  ... on SiretChamp {\n    etablissement {\n      ...PersonneMoraleFragment\n    }\n  }\n  ... on CarteChamp {\n    geoAreas {\n      ...GeoAreaFragment\n    }\n  }\n  ... on DossierLinkChamp {\n    dossier {\n      id\n      state\n      usager {\n        email\n      }\n    }\n  }\n}\n\nfragment ChampFragment on Champ {\n  id\n  label\n  stringValue\n  ... on DateChamp {\n    date\n  }\n  ... on DatetimeChamp {\n    datetime\n  }\n  ... on CheckboxChamp {\n    checked: value\n  }\n  ... on DecimalNumberChamp {\n    decimalNumber: value\n  }\n  ... on IntegerNumberChamp {\n    integerNumber: value\n  }\n  ... on CiviliteChamp {\n    civilite: value\n  }\n  ... on LinkedDropDownListChamp {\n    primaryValue\n    secondaryValue\n  }\n  ... on MultipleDropDownListChamp {\n    values\n  }\n  ... on PieceJustificativeChamp {\n    file {\n      ...FileFragment\n    }\n  }\n  ... on AddressChamp {\n    address {\n      ...AddressFragment\n    }\n  }\n  ... on CommuneChamp {\n    commune {\n      name\n      code\n    }\n    departement {\n      name\n      code\n    }\n  }\n}\n\nfragment PersonneMoraleFragment on PersonneMorale {\n  siret\n  siegeSocial\n  naf\n  libelleNaf\n  address {\n    ...AddressFragment\n  }\n  entreprise {\n    siren\n    capitalSocial\n    numeroTvaIntracommunautaire\n    formeJuridique\n    formeJuridiqueCode\n    nomCommercial\n    raisonSociale\n    siretSiegeSocial\n    codeEffectifEntreprise\n    dateCreation\n    nom\n    prenom\n    attestationFiscaleAttachment {\n      ...FileFragment\n    }\n    attestationSocialeAttachment {\n      ...FileFragment\n    }\n  }\n  association {\n    rna\n    titre\n    objet\n    dateCreation\n    dateDeclaration\n    datePublication\n  }\n}\n\nfragment FileFragment on File {\n  filename\n  contentType\n  checksum\n  byteSizeBigInt\n  url\n}\n\nfragment AddressFragment on Address {\n  label\n  type\n  streetAddress\n  streetNumber\n  streetName\n  postalCode\n  cityName\n  cityCode\n  departmentName\n  departmentCode\n  regionName\n  regionCode\n}","variables":{"demarcheNumber":'$DEMARCHENUMBER'}}'